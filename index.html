<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="docs/assets/ico/favicon.ico">

    <title>Graphs That Go Up!</title>

    <!-- Bootstrap core CSS -->
    <link href="dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="dist/css/bootstrap-theme.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="theme.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="docs/assets/js/ie-emulation-modes-warning.js"></script>

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="docs/assets/js/ie10-viewport-bug-workaround.js"></script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->


    <!-- D3 -->
    <style>
      .axis path,
      .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
      }

      //.area {
      //  fill: steelblue;
      //}

      .bar {
  fill: red;
}

.bar:hover {
  fill: brown;
}

.line {
  fill: none;
  //stroke: steelblue;
  stroke-width: 3px;
}

    </style>

    <script src="/d3.v3.js"></script>
  </head>

  <body role="document">

    <!-- Fixed navbar -->
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Graphs That Go Up!</a>
        </div>
        <!--div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#contact">Contact</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="#">Action</a></li>
                <li><a href="#">Another action</a></li>
                <li><a href="#">Something else here</a></li>
                <li class="divider"></li>
                <li class="dropdown-header">Nav header</li>
                <li><a href="#">Separated link</a></li>
                <li><a href="#">One more separated link</a></li>
              </ul>
            </li>
          </ul>
        </div--><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container theme-showcase" role="main">

      <!-- Main jumbotron for a primary marketing message or call to action -->
      <div class="jumbotron">
        <h1>Instantly show upward trends.</h1>
        <p>No real data needed. Choose the axes names and create.</p>
        <p><a href="#create" class="btn btn-primary btn-lg" role="button">Build your graph now &raquo;</a></p>
      </div>

      <div id="create" class="page-header">
        <h1>Create your graph...</h1>
      </div>

<p>
  <form class="form-inline" role="form">
    <div class="form-group">
      <h3>
        <span class="label label-primary">X Axis</span>
        <label class="sr-only" for="xAxis">1980 to 2010</label>
        <input type="text" class="form-control" id="xAxis" placeholder="1980 to 2010">
      </h3>
    </div>
    <div class="form-group">
      <h3>
        <span class="label label-primary">Y Axis</span>
        <label class="sr-only" for="yAxis">Temperature</label>
        <input type="text" class="form-control" id="yAxis" placeholder="Temperature">
      </h3>
    </div>
    <div class="form-group">
      <h3>
        <button type="button" class="btn btn-success" onclick="createGraph();">Create</button>
      </h3>
    </div>
    <div class="form-group">
      <h3>
        <button type="button" class="btn btn-info" onclick="createExample();">Example Â»</button>
      </h3>
    </div>
  </form>
</p>

<p id="graph">
</p>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/jquery.min.js"></script>
    <script src="/dist/js/bootstrap.min.js"></script>
    <script src="/docs/assets/js/docs.min.js"></script>
<script>

var COLORS = 
  [
    [["#66c2a4"],["#8c96c6"],["#7bccc4"],["#238b45"],["#88419d"]],
    [["#66c2a4","#238b45"],["#8c96c6","#88419d"],["#7bccc4","#2b8cbe"]]
  ];

var ALGO = ["LINEAR", "EXPO", "HOCKY"];

var CHARTTYPE = ["BAR","LINE"];

var EXAMPLES =
  [
    ["1960 to 2010", "Temperatures vs Sea Level"],
    ["2013", "Users, Revenue and Profit"],
    ["2004 to 2014", "AAPL Market Cap. vs GOOG Market Cap"],
    ["2000 to 2013", "Wealth of top 1% vs # of foodbanks"]
  ];

var exampleIndex = 0;

function randomElementFromArray(items)
{
  var item = items[Math.floor(Math.random()*items.length)];
  return item;
}

function generateData(points)
{
  var algo = randomElementFromArray(ALGO);
  var data = [];
  if(algo == "LINEAR") //linear
  {
    for(var i = 0; i < points; i++)
    {
      data.push(i/(points-0.1) + 0.1);
    }
  }
  else if(algo == "EXPO")
  {
    for(var i = 0; i < points; i++)
    {
      data.push(Math.pow(i/(points-0.1) + 0.1,3));
    }
  }
  else
  {
   for(var i = 0; i < points; i++)
    {
      if(i < points-1)
        data.push(i/(points/0.3-0.1) + 0.1);
      else
        data.push(i/(points-0.1) + 0.1);
    } 
  }

  return jitter(data);
}

function generateMultiData(points,numSeries)
{
  var series = [];
  for(var i = 0; i < numSeries; i++)
  {
    series.push(generateData(points));
  }
  return series;
}

function getXValues(input)
{
  //if dates parse as dates
  //if numbers parse as numbers
  //else return string
  return [new Date("1960"),new Date("1970"),new Date("1980"),new Date("1990"),new Date("2000")];
}

function getSeries(input)
{
  //return ["Temperature"];
  return ["Temperature", "Sea Level"];
}

function jitter(data)
{
  var newData = [];
  var shift = 0.1*Math.random();
  for(var i = 0; i < data.length; i++)
  {
    newData.push(data[i]*(0.7+0.3*Math.random()+shift));
  }
  return newData;
}

function transformMultiDataForD3(xValues,yValues,series)
{

  var multiData = [];
  for (var i = 0; i < yValues.length; i ++)
  {
    var data = [];
    for (var j = 0; j < xValues.length; j++) {
       data.push({xv:xValues[j],yv:yValues[i][j],series:series[i]});
    }
    multiData.push(data);
  }
  return multiData;
}

function flattenMultiData(multiData)
{
  var data = [];
  for (var i = 0; i < multiData.length; i++)
  {
    Array.prototype.push.apply(data,multiData[i])
  }
  return data;
}

function createExample()
{
  exampleIndex +=1;
  if(exampleIndex >= EXAMPLES.length)
    exampleIndex = 0;
  $("#xAxis").val(EXAMPLES[exampleIndex][0]);
  $("#yAxis").val(EXAMPLES[exampleIndex][1]);

  createGraph();
}

function createGraph()
{
  //xValues are either dates or a label
  var xValues = getXValues($("#xAxis").val());
  var series = getSeries($("#yAxis").val());
  //yValues is one or more labels 
  var yValues = generateMultiData(xValues.length,series.length);

  var colors = randomElementFromArray(COLORS[series.length-1]);

  var chartType = randomElementFromArray(CHARTTYPE);

  renderGraph(xValues,yValues,series,colors,chartType);

  }

  function renderGraph(xValues,yValues,series,colors,chartType)
  {
    $("#graph").empty();

    var margin = {top: 20, right: 20, bottom: 30, left: 50},
      width = 500 - margin.left - margin.right,
      height = 300 - margin.top - margin.bottom;

    var y = d3.scale.linear()
      .range([height, 0]);

    //For Lines
    var x = d3.time.scale()
      .range([0, width]);

    //For Bars
    var x0 = d3.scale.ordinal()
      .rangeRoundBands([0, width], .1);
    var x1 = d3.scale.ordinal();

    var xAxis = d3.svg.axis();

    //For Line or area
    if(chartType == "LINE")
    {
      xAxis.scale(x)
        .orient("bottom")
        .ticks(d3.time.years, 10);
    }
    else
    {
    //The Bars
      xAxis.scale(x0)
        .orient("bottom")
        .ticks(d3.time.years, 10)
        .tickFormat(d3.time.format("%Y"));
    }
    var yAxis = d3.svg.axis()
      .scale(y)
      .tickFormat("")
      .orient("left")
      .tickValues([]);

    multiData = transformMultiDataForD3(xValues,yValues,series);

    x.domain(d3.extent(xValues));
    y.domain([0, 1]);

    x0.domain(xValues);
    x1.domain(series).rangeRoundBands([0, x0.rangeBand()]);
  
    //Create render functions
    var area = d3.svg.area()
      .x(function(d) { return x(d.xv); })
      .y0(height)
      .y1(function(d) { return y(d.yv); });
  
    var line = d3.svg.line()
      .x(function(d) { return x(d.xv); })
      .y(function(d) { return y(d.yv); });

    //Create the SVG
    var svg = d3.select("#graph").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    //Get random color
    var color = d3.scale.ordinal()
      .range(colors);

    //Render the data sets
    if(chartType == "LINE")
    {
      //if there is only one and this is a line chart
      if(multiData.length ==1)
      {
        var data = multiData[0];
        svg.append("path")
          .datum(data)
          .attr("class", "area")
          .attr("d", area)
          .attr("fill",color(series[i]));
      }
      else
      {
        for(var i = 0; i < multiData.length; i++)
        {
          var data = multiData[i];
          svg.append("path")
            .datum(data)
            .attr("class", "line")
            .attr("d", line)
            .attr("stroke",color(series[i]));
        }
      }
    }
    else{
      var flatData = flattenMultiData(multiData);

      var state = svg.selectAll(".state")
        .data(flatData)
      .enter().append("g")
        .attr("class", "g")
        .attr("transform", function(d) { return "translate(" + x0(d.xv) + ",0)"; });

      state.selectAll("rect")
        .data(function(d) { return [d]; })
      .enter().append("rect")
        .attr("width", x1.rangeBand())
        .attr("x", function(d) { return x1(d.series); })
        .attr("y", function(d) { return y(d.yv); })
        .attr("height", function(d) { return height - y(d.yv); })
        .style("fill", function(d) { return color(d.series); });
    }

    //Add the Axis
    svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

    svg.append("g")
      .attr("class", "y axis")
      .call(yAxis);

    //Label the Y axis or add a legend
    if(series.length == 1)
    {
      svg.append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 6)
        .attr("dy", ".71em")
        .style("text-anchor", "end")
        .text(series[0]);
    }
    else
    {
      var legend = svg.selectAll(".legend")
        .data(color.domain().slice().reverse())
        .enter().append("g")
        .attr("class", "legend")
        .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

      legend.append("rect")
        .attr("x", 6)
        .attr("width", 18)
        .attr("height", 18)
        .style("fill", color);

      legend.append("text")
        .attr("x", 27)
        .attr("y", 9)
        .attr("dy", ".35em")
        .text(function(d) { return d; });
    }
  }
  createGraph();
</script>

</body>
</html>
